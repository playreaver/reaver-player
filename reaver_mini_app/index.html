<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Hey, Reaver ‚Ä¢ Liquid Glass AI —á–∞—Ç</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --bg1: #050716;
      --bg2: #040b20;
      --accent1: #00d4ff;
      --accent2: #4e6bff;
      --accent3: #ff6584;
      --accent4: #6cffc8;
      --text: #f7f7ff;
      --muted: #a9b0d9;
      --glass: rgba(8, 13, 32, 0.35);
      --glass-inner: rgba(10, 16, 40, 0.65);
      --border-soft: rgba(255, 255, 255, 0.14);
      --border-strong: rgba(255, 255, 255, 0.22);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text);
      background:
        radial-gradient(circle at 0 0, #38136f 0, transparent 55%),
        radial-gradient(circle at 110% 100%, #004e99 0, transparent 55%),
        radial-gradient(circle at -10% 120%, #180e40 0, transparent 55%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 14px;
      overflow: hidden;
    }

    .wrapper {
      width: 100%;
      max-width: 520px;
      position: relative;
    }

    /* –±–æ–ª—å—à–∏–µ ‚Äú–ø—É–∑—ã—Ä—å–∫–∏‚Äù –Ω–∞ —Ñ–æ–Ω–µ */
    .bubble {
      position: absolute;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, rgba(255,255,255,0.3), transparent 55%);
      backdrop-filter: blur(24px);
      opacity: 0.35;
      mix-blend-mode: screen;
      pointer-events: none;
    }

    .bubble.b1 {
      width: 220px;
      height: 220px;
      top: -70px;
      right: -40px;
      background: radial-gradient(circle at 30% 20%, rgba(0, 212, 255, 0.45), transparent 60%);
      animation: bubbleFloat1 20s ease-in-out infinite;
    }

    .bubble.b2 {
      width: 260px;
      height: 260px;
      bottom: -110px;
      left: -80px;
      background: radial-gradient(circle at 60% 70%, rgba(255, 101, 132, 0.45), transparent 60%);
      animation: bubbleFloat2 24s ease-in-out infinite;
    }

    .bubble.b3 {
      width: 160px;
      height: 160px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -40%);
      background: radial-gradient(circle at 50% 40%, rgba(108, 255, 200, 0.5), transparent 65%);
      animation: bubbleFloat3 28s ease-in-out infinite;
    }

    @keyframes bubbleFloat1 {
      0%, 100% { transform: translate(0, 0); }
      50% { transform: translate(-28px, 26px); }
    }
    @keyframes bubbleFloat2 {
      0%, 100% { transform: translate(0, 0); }
      50% { transform: translate(30px, -24px); }
    }
    @keyframes bubbleFloat3 {
      0%, 100% { transform: translate(-50%, -40%); }
      50% { transform: translate(-47%, -46%); }
    }

    /* –æ—Å–Ω–æ–≤–Ω–∞—è ‚Äú–∫–∞–ø—Å—É–ª–∞‚Äù */
    .card {
      position: relative;
      z-index: 2;
      border-radius: 30px;
      padding: 2px;
      background:
        radial-gradient(circle at 0 0, rgba(255,255,255,0.24), transparent 60%),
        radial-gradient(circle at 100% 100%, rgba(0,212,255,0.35), transparent 60%),
        linear-gradient(135deg, rgba(255,255,255,0.04), rgba(255,255,255,0.18));
      box-shadow:
        0 26px 60px rgba(0, 0, 0, 0.78),
        0 0 50px rgba(0, 212, 255, 0.15);
      backdrop-filter: blur(32px);
      animation: cardFloat 12s ease-in-out infinite;
    }

    @keyframes cardFloat {
      0%,100% { transform: translateY(0); }
      50% { transform: translateY(-6px); }
    }

    .card-inner {
      border-radius: 28px;
      background: var(--glass-inner);
      padding: 16px 16px 18px;
      border: 1px solid rgba(255,255,255,0.12);
      backdrop-filter: blur(28px);
    }

    .header-row {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
    }

    .logo-chip {
      width: 56px;
      height: 56px;
      border-radius: 22px;
      background: linear-gradient(135deg, rgba(0,198,255,0.2), rgba(0,140,255,0.65));
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.32);
      box-shadow:
        0 16px 35px rgba(0,0,0,0.8),
        0 0 25px rgba(0,198,255,0.6);
    }

    .logo-chip img {
      width: 130%;
      height: auto;
      transform: translateX(6px);
    }

    .title-block {
      flex: 1;
      min-width: 0;
    }

    .title {
      font-size: 18px;
      font-weight: 700;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      background: linear-gradient(110deg, #ffffff, #e6f6ff, #ffe9f0);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      font-size: 12px;
      color: var(--muted);
      margin-top: 4px;
    }

    .soon-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      background: radial-gradient(circle at 0 0, rgba(0,212,255,0.26), transparent 70%);
      background-color: rgba(3, 7, 25, 0.9);
      border: 1px solid rgba(255,255,255,0.28);
      margin-top: 8px;
      backdrop-filter: blur(18px);
    }

    .soon-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--accent1);
      box-shadow: 0 0 12px rgba(0,212,255,0.9);
      animation: pulse 1.4s ease-out infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      70% { transform: scale(1.7); opacity: 0; }
      100% { transform: scale(1); opacity: 0; }
    }

    .mode-switcher {
      display: flex;
      gap: 8px;
      margin: 14px 0 10px;
    }

    .mode-btn {
      flex: 1;
      padding: 9px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.18);
      background: radial-gradient(circle at 0 0, rgba(255,255,255,0.16), transparent 60%);
      background-color: rgba(5, 9, 28, 0.9);
      color: var(--muted);
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.22s ease;
      backdrop-filter: blur(18px);
    }

    .mode-btn.active {
      background:
        radial-gradient(circle at 0 0, rgba(0,212,255,0.5), transparent 60%),
        linear-gradient(135deg, rgba(0,212,255,0.3), rgba(78,107,255,0.45));
      color: var(--text);
      box-shadow: 0 0 22px rgba(0, 212, 255, 0.5);
      border-color: rgba(255,255,255,0.55);
    }

    .mode-btn:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: none;
    }

    /* ===== –§–£–ù–ö–¶–ò–ò ===== */
    .features {
      border-radius: 22px;
      padding: 12px 13px;
      background: radial-gradient(circle at 0 100%, rgba(0,212,255,0.35), transparent 70%);
      background-color: rgba(5, 10, 30, 0.9);
      border: 1px solid rgba(255,255,255,0.14);
      overflow: hidden;
      position: relative;
      backdrop-filter: blur(20px);
    }

    .features::before {
      content: "";
      position: absolute;
      inset: -40%;
      background: conic-gradient(
        from 210deg,
        transparent 0deg,
        rgba(255,255,255,0.08) 40deg,
        transparent 80deg
      );
      opacity: 0.4;
      mix-blend-mode: screen;
      animation: rotateGlow 24s linear infinite;
    }

    @keyframes rotateGlow {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .features-content {
      position: relative;
      z-index: 1;
    }

    .features-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--muted);
      margin-bottom: 6px;
    }

    .features-viewport {
      position: relative;
      height: 54px;
    }

    .feature-item {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      opacity: 0;
      transform: translateY(10px);
      animation: featureCycle 15s infinite;
    }

    .feature-item span.icon {
      font-size: 16px;
      width: 22px;
      text-align: center;
    }

    .feature-item:nth-child(1) { animation-delay: 0s; }
    .feature-item:nth-child(2) { animation-delay: 3s; }
    .feature-item:nth-child(3) { animation-delay: 6s; }
    .feature-item:nth-child(4) { animation-delay: 9s; }
    .feature-item:nth-child(5) { animation-delay: 12s; }

    @keyframes featureCycle {
      0%   { opacity: 0; transform: translateY(10px); }
      8%   { opacity: 1; transform: translateY(0); }
      22%  { opacity: 1; transform: translateY(0); }
      30%  { opacity: 0; transform: translateY(-8px); }
      100% { opacity: 0; transform: translateY(-8px); }
    }

    /* ===== –ß–ê–¢ ===== */

    .chat-container {
      margin-top: 11px;
      border-radius: 22px;
      padding: 12px 13px 14px;
      background:
        radial-gradient(circle at 100% 0, rgba(255,101,132,0.3), transparent 70%);
      background-color: rgba(5, 10, 30, 0.92);
      border: 1px solid rgba(255,255,255,0.14);
      display: none;
      flex-direction: column;
      max-height: 65vh;
      min-height: 50vh;
      backdrop-filter: blur(20px);
    }

    @media (max-height: 650px) {
      .chat-container {
        max-height: 56vh;
        min-height: 46vh;
      }
    }

    .chat-controls {
      display: flex;
      gap: 7px;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }

    .chat-mode-btn {
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.18);
      background-color: rgba(7, 10, 32, 0.9);
      color: var(--muted);
      font-size: 11px;
      cursor: pointer;
      flex: 1;
      min-width: 0;
      backdrop-filter: blur(18px);
    }

    .chat-mode-btn.active {
      background: linear-gradient(135deg, rgba(255,101,132,0.3), rgba(255,101,132,0.12));
      color: var(--text);
      border-color: rgba(255,255,255,0.5);
      box-shadow: 0 0 18px rgba(255,101,132,0.55);
    }

    .clear-chat-btn {
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.2);
      background-color: rgba(35, 5, 22, 0.9);
      color: var(--accent3);
      font-size: 11px;
      cursor: pointer;
      white-space: nowrap;
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      margin-bottom: 9px;
      padding-right: 4px;
    }

    .chat-messages::-webkit-scrollbar { width: 4px; }
    .chat-messages::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.05);
      border-radius: 2px;
    }
    .chat-messages::-webkit-scrollbar-thumb {
      background: var(--accent1);
      border-radius: 2px;
    }

    .message {
      margin-bottom: 9px;
      padding: 8px 10px;
      border-radius: 16px;
      font-size: 13px;
      line-height: 1.4;
      animation: messageSlide 0.22s ease-out both;
    }

    @keyframes messageSlide {
      0% { transform: translateY(6px); opacity: 0; }
      100% { transform: translateY(0); opacity: 1; }
    }

    .message.user {
      background: linear-gradient(135deg, rgba(0,212,255,0.25), rgba(78,107,255,0.22));
      border: 1px solid rgba(0,212,255,0.5);
      margin-left: 26px;
      box-shadow: 0 6px 20px rgba(0,212,255,0.33);
    }

    .message.assistant {
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.22);
      margin-right: 26px;
      box-shadow: 0 6px 22px rgba(0,0,0,0.8);
    }

    .message-text {
      word-wrap: break-word;
    }

    .message-text code {
      font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      background: rgba(0,0,0,0.4);
      padding: 1px 4px;
      border-radius: 4px;
    }

    .message-text pre {
      margin: 6px 0 4px;
      padding: 8px;
      background: rgba(0,0,0,0.6);
      border-radius: 10px;
      overflow-x: auto;
      font-size: 12px;
    }

    .message-text ul,
    .message-text ol {
      padding-left: 18px;
      margin: 4px 0;
    }

    .message-meta {
      font-size: 10px;
      color: var(--muted);
      margin-top: 4px;
      text-align: right;
    }

    .typing-indicator {
      display: flex;
      gap: 4px;
      padding: 6px 4px;
      align-items: center;
      font-size: 12px;
      color: var(--muted);
    }

    .typing-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--accent1);
      animation: typingBounce 1.4s ease-in-out infinite both;
    }

    .typing-dot:nth-child(1) { animation-delay: -0.32s; }
    .typing-dot:nth-child(2) { animation-delay: -0.16s; }
    .typing-dot:nth-child(3) { animation-delay: 0s; }

    @keyframes typingBounce {
      0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
      40% { transform: scale(1); opacity: 1; }
    }

    .chat-input-container {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .chat-input {
      flex: 1;
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.22);
      background: radial-gradient(circle at 0 0, rgba(255,255,255,0.18), transparent 65%);
      background-color: rgba(5, 8, 28, 0.95);
      color: var(--text);
      font-size: 13px;
      outline: none;
      resize: none;
      min-height: 40px;
      max-height: 110px;
      backdrop-filter: blur(18px);
    }

    .chat-input:focus {
      border-color: var(--accent1);
      box-shadow: 0 0 0 2px rgba(0,212,255,0.25);
    }

    .send-btn {
      padding: 10px 12px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,0.4);
      background:
        radial-gradient(circle at 0 0, rgba(255,255,255,0.35), transparent 60%),
        linear-gradient(135deg, var(--accent1), var(--accent2));
      color: #050714;
      cursor: pointer;
      font-weight: 700;
      min-width: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 12px 24px rgba(0,212,255,0.75);
      backdrop-filter: blur(18px);
      transition: all 0.18s ease-out;
    }

    .send-btn:active {
      transform: scale(0.95) translateY(1px);
      box-shadow: 0 6px 16px rgba(0,212,255,0.6);
    }

    .send-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .bottom-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 13px;
      font-size: 11px;
      color: var(--muted);
    }

    .tag {
      padding: 4px 9px;
      border-radius: 999px;
      background-color: rgba(4, 10, 28, 0.9);
      border: 1px solid rgba(255,255,255,0.22);
      backdrop-filter: blur(18px);
    }

    .bot-handle {
      opacity: 0.92;
    }

    @media (max-width: 360px) {
      .card-inner { padding: 13px; }
      .title { font-size: 16px; }
      .logo-chip { width: 50px; height: 50px; border-radius: 20px; }
      .chat-container { min-height: 46vh; }
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="bubble b1"></div>
    <div class="bubble b2"></div>
    <div class="bubble b3"></div>

    <div class="card">
      <div class="card-inner">
        <div class="header-row">
          <div class="logo-chip">
            <!-- —Å—é–¥–∞ —Ç–≤–æ–π –ª–æ–≥–æ—Ç–∏–ø, –∫–∞–∫ –Ω–∞ –±–∞–Ω–Ω–µ—Ä–µ -->
            <img src="heyreaver_logo.png" alt="Hey, Reaver logo">
          </div>
          <div class="title-block">
            <div class="title">Hey, Reaver ‚Ä¢ AI —á–∞—Ç</div>
            <div class="subtitle">–ù–æ–≤–∞—è –∞–π–¥–µ–Ω—Ç–∏–∫–∞ –≤ –¥–µ–ª–µ. –ñ–∏–¥–∫–æ–µ —Å—Ç–µ–∫–ª–æ + –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç.</div>
            <div class="soon-pill">
              <div class="soon-dot"></div>
              <span>Groq AI ‚Ä¢ ultra fast</span>
            </div>
          </div>
        </div>

        <div class="mode-switcher">
          <button class="mode-btn active" id="mode-features" onclick="switchMode('features')">–§—É–Ω–∫—Ü–∏–∏ –±–æ—Ç–∞</button>
          <button class="mode-btn" id="mode-chat" onclick="switchMode('chat')">AI-—á–∞—Ç</button>
        </div>

        <!-- –§–£–ù–ö–¶–ò–ò -->
        <div class="features" id="features-section">
          <div class="features-content">
            <div class="features-label">—á—Ç–æ —É–∂–µ —É–º–µ–µ—Ç hey, reaver</div>
            <div class="features-viewport">
              <div class="feature-item">
                <span class="icon">üéµ</span>
                <span>–°–∫–∞—á–∏–≤–∞–µ—Ç —Ç—Ä–µ–∫–∏ –≤ MP3 –ø–æ –∑–∞–ø—Ä–æ—Å—É <code>–Ω–∞–π—Ç–∏&nbsp;—Ç—Ä–µ–∫</code></span>
              </div>
              <div class="feature-item">
                <span class="icon">üìπ</span>
                <span>–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤–∏–¥–µ–æ 360p / 720p —Å YouTube</span>
              </div>
              <div class="feature-item">
                <span class="icon">‚≠ê</span>
                <span>Premium: 1080p, –±–µ–∑–ª–∏–º–∏—Ç –∏ —Å–æ—Ü—Å–µ—Ç–∏ (Instagram, X)</span>
              </div>
              <div class="feature-item">
                <span class="icon">‚è≥</span>
                <span>–¢—Ä–∏–∞–ª –∏ –ø–æ–¥–ø–∏—Å–∫–∞ –∑–∞ Telegram Stars ‚Äî –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫–∞—Ä—Ç</span>
              </div>
              <div class="feature-item">
                <span class="icon">üéÅ</span>
                <span>–ü—Ä–æ–º–æ–∫–æ–¥—ã, –∞–∫—Ü–∏–æ–Ω–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã –∏ –ø–æ–¥–∞—Ä–æ—á–Ω—ã–π Premium</span>
              </div>
            </div>
          </div>
        </div>

        <!-- –ß–ê–¢ -->
        <div class="chat-container" id="chat-section">
          <div class="chat-controls">
            <button class="chat-mode-btn active" onclick="switchChatMode('assistant', this)">–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç</button>
            <button class="chat-mode-btn" onclick="switchChatMode('creative', this)">–ö—Ä–µ–∞—Ç–∏–≤–Ω—ã–π</button>
            <button class="chat-mode-btn" onclick="switchChatMode('expert', this)">–≠–∫—Å–ø–µ—Ä—Ç</button>
            <button class="clear-chat-btn" onclick="clearChat()">–û—á–∏—Å—Ç–∏—Ç—å</button>
          </div>

          <div class="chat-messages" id="chat-messages">
            <div class="message assistant">
              <div class="message-text">
                <p><strong>–ü—Ä–∏–≤–µ—Ç!</strong> –Ø AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç Hey, Reaver.</p>
                <p>–í—ã–±–∏—Ä–∞–π —Ä–µ–∂–∏–º —Å–≤–µ—Ä—Ö—É –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ –≤–æ–ø—Ä–æ—Å ‚Äî –ø–æ–º–æ–≥—É —Å –±–æ—Ç–æ–º, –∏–¥–µ—è–º–∏ –∏ —á–µ–º —É–≥–æ–¥–Ω–æ. üöÄ</p>
              </div>
              <div class="message-meta">–°–∏—Å—Ç–µ–º–∞ ‚Ä¢ —Ç–æ–ª—å–∫–æ —á—Ç–æ</div>
            </div>
          </div>

          <div class="chat-input-container">
            <textarea
              class="chat-input"
              id="chat-input"
              placeholder="–ù–∞–ø–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶ (Enter ‚Äî –æ—Ç–ø—Ä–∞–≤–∏—Ç—å, Shift+Enter ‚Äî –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏)"
              maxlength="1000"
              rows="1"
            ></textarea>
            <button class="send-btn" id="send-btn" onclick="sendMessage()">‚û§</button>
          </div>
        </div>

        <div class="bottom-row">
          <div class="tag">Liquid Glass UI ‚Ä¢ Groq AI</div>
          <div class="bot-handle">@reaver_youtube_bot</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const tg = window.Telegram?.WebApp;

    if (tg) {
      tg.ready();
      tg.expand();
      document.body.style.backgroundColor = tg.backgroundColor || "#050716";

      const user = tg.initDataUnsafe?.user;
      if (user) {
        const subtitle = document.querySelector(".subtitle");
        const name = user.username ? "@" + user.username : (user.first_name || "–¥—Ä—É–≥");
        subtitle.textContent = `–ü—Ä–∏–≤–µ—Ç, ${name}. –£–ø—Ä–∞–≤–ª—è–π –±–æ—Ç–æ–º –∏ –æ–±—â–∞–π—Å—è —Å AI –ø—Ä—è–º–æ –∑–¥–µ—Å—å.`;
      }
    }

    /* ===== Markdown —Ä–µ–Ω–¥–µ—Ä–µ—Ä ===== */

    function escapeHtml(str) {
      return str
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;");
    }

    function renderMarkdown(md) {
      if (!md) return "";
      let text = escapeHtml(md);

      text = text.replace(/^### (.+)$/gm, "<h3>$1</h3>");
      text = text.replace(/^## (.+)$/gm, "<h2>$1</h2>");
      text = text.replace(/^# (.+)$/gm, "<h1>$1</h1>");

      text = text.replace(/(^|\n)[ \t]*[-*] (.+)/g, (m, p1, item) => `${p1}<ul><li>${item}</li></ul>`);
      text = text.replace(/<\/ul>\s*<ul>/g, "</ul>");

      text = text.replace(/\*\*(.+?)\*\*/g, "<strong>$1</strong>");
      text = text.replace(/\*(.+?)\*/g, "<em>$1</em>");
      text = text.replace(/`([^`]+)`/g, "<code>$1</code>");
      text = text.replace(/\[([^\]]+)\]\((https?:\/\/[^\s)]+)\)/g, '<a href="$2" target="_blank" rel="noreferrer">$1</a>');
      text = text.replace(/```([\s\S]*?)```/g, "<pre><code>$1</code></pre>");

      text = text.replace(/\n{2,}/g, "</p><p>");
      text = "<p>" + text.replace(/\n/g, "<br>") + "</p>";
      return text;
    }

    /* ===== –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ ===== */

    function switchMode(mode) {
      const featuresBtn = document.getElementById("mode-features");
      const chatBtn = document.getElementById("mode-chat");
      const featuresSection = document.getElementById("features-section");
      const chatSection = document.getElementById("chat-section");

      if (mode === "features") {
        featuresBtn.classList.add("active");
        chatBtn.classList.remove("active");
        featuresSection.style.display = "block";
        chatSection.style.display = "none";
      } else {
        featuresBtn.classList.remove("active");
        chatBtn.classList.add("active");
        featuresSection.style.display = "none";
        chatSection.style.display = "flex";
        setTimeout(() => document.getElementById("chat-input").focus(), 200);
      }
    }

    let chatMode = "assistant";
    let chatHistory = [];
    let isWaitingForResponse = false;

    function switchChatMode(mode, btn) {
      chatMode = mode;
      document.querySelectorAll(".chat-mode-btn").forEach(b => b.classList.remove("active"));
      if (btn) btn.classList.add("active");
      addSystemMessage(`–†–µ–∂–∏–º: ${getModeDescription(mode)}`);
    }

    function getModeDescription(mode) {
      const modes = {
        assistant: "–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç ‚Äî –ø–æ–º–æ–≥–∞–µ—Ç —Å –±–æ—Ç–æ–º –∏ –ª—é–±—ã–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏",
        creative: "–ö—Ä–µ–∞—Ç–∏–≤–Ω—ã–π ‚Äî –∏–¥–µ–∏, —Ç–µ–∫—Å—Ç—ã, —Å—Ü–µ–Ω–∞—Ä–∏–∏",
        expert: "–≠–∫—Å–ø–µ—Ä—Ç ‚Äî –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω—ã–µ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã"
      };
      return modes[mode] || "–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç";
    }

    function clearChat() {
      const container = document.getElementById("chat-messages");
      container.innerHTML = "";
      chatHistory = [];
      addSystemMessage("–ß–∞—Ç –æ—á–∏—â–µ–Ω. –û —á—ë–º –ø–æ–≥–æ–≤–æ—Ä–∏–º? üéß");
    }

    function addSystemMessage(text) {
      addMessage(text, "assistant", true);
    }

    function addMessage(text, sender, isSystem = false) {
      const container = document.getElementById("chat-messages");
      const div = document.createElement("div");
      div.className = `message ${sender}`;

      const ts = new Date().toLocaleTimeString("ru-RU", { hour: "2-digit", minute: "2-digit" });

      div.innerHTML = `
        <div class="message-text">${renderMarkdown(text)}</div>
        <div class="message-meta">${isSystem ? "–°–∏—Å—Ç–µ–º–∞" : (sender === "user" ? "–í—ã" : "AI")} ‚Ä¢ ${ts}</div>
      `;
      container.appendChild(div);
      container.scrollTop = container.scrollHeight;
    }

    function showTyping() {
      const container = document.getElementById("chat-messages");
      const div = document.createElement("div");
      div.className = "typing-indicator";
      div.id = "typing-indicator";
      div.innerHTML = `
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
        <span style="margin-left: 6px;">AI –ø–µ—á–∞—Ç–∞–µ—Ç‚Ä¶</span>
      `;
      container.appendChild(div);
      container.scrollTop = container.scrollHeight;
    }

    function hideTyping() {
      const el = document.getElementById("typing-indicator");
      if (el) el.remove();
    }

    async function sendMessage() {
      if (isWaitingForResponse) return;

      const input = document.getElementById("chat-input");
      const text = input.value.trim();
      if (!text) return;

      addMessage(text, "user");
      input.value = "";
      resizeTextarea();

      showTyping();
      isWaitingForResponse = true;
      document.getElementById("send-btn").disabled = true;

      try {
        const answer = await callGroqAPI(text, chatMode);
        hideTyping();
        addMessage(answer, "assistant");
        chatHistory.push({ role: "user", content: text });
        chatHistory.push({ role: "assistant", content: answer });
        if (chatHistory.length > 20) chatHistory = chatHistory.slice(-20);
      } catch (e) {
        console.error(e);
        hideTyping();
        addMessage("–ò–∑–≤–∏–Ω–∏, —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫. –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑ —á—É—Ç—å –ø–æ–∑–∂–µ.", "assistant");
      }

      isWaitingForResponse = false;
      document.getElementById("send-btn").disabled = false;
    }

    /* ===== Groq API ===== */

    const GROQ_API_KEY = "YOUR_GROQ_API_KEY_HERE"; // ‚ö† –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≤–æ–π —Å–µ—Ä–≤–µ—Ä-–ø—Ä–æ–∫—Å–∏
    const GROQ_API_URL = "https://api.groq.com/openai/v1/chat/completions";

    async function callGroqAPI(userMessage, mode) {
      if (!GROQ_API_KEY || GROQ_API_KEY === "YOUR_GROQ_API_KEY_HERE") {
        await new Promise(r => setTimeout(r, 600 + Math.random() * 600));
        return getMockResponse(userMessage, mode);
      }

      const systemPrompt = getSystemPrompt(mode);
      const messages = [
        { role: "system", content: systemPrompt },
        ...chatHistory,
        { role: "user", content: userMessage }
      ];

      const res = await fetch(GROQ_API_URL, {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${GROQ_API_KEY}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          model: "llama3-8b-8192",
          messages,
          temperature: getTemperature(mode),
          max_tokens: 1024,
          stream: false
        })
      });

      if (!res.ok) throw new Error("Groq API error: " + res.status);
      const data = await res.json();
      return data.choices?.[0]?.message?.content || "–ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç –æ—Ç –º–æ–¥–µ–ª–∏ üòî";
    }

    function getSystemPrompt(mode) {
      const prompts = {
        assistant: `–¢—ã –ø–æ–ª–µ–∑–Ω—ã–π AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –±–æ—Ç–∞ Hey, Reaver.
–ü–æ–º–æ–≥–∞–µ—à—å —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –±–æ—Ç–∞ –∏ –ª—é–±—ã–º–∏ –æ–±—â–∏–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏.
–ü–∏—à–∏ –∫–æ—Ä–æ—Ç–∫–æ, –Ω–æ –ø–æ –¥–µ–ª—É. –ò—Å–ø–æ–ª—å–∑—É–π Markdown: —Å–ø–∏—Å–∫–∏, –≤—ã–¥–µ–ª–µ–Ω–∏–µ, –∫–æ–¥.`,
        creative: `–¢—ã –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–π AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç.
–ü–æ–º–æ–≥–∞–µ—à—å –ø—Ä–∏–¥—É–º—ã–≤–∞—Ç—å –∏–¥–µ–∏, —Ç–µ–∫—Å—Ç—ã, –æ–ø–∏—Å–∞–Ω–∏—è, —Å—Ü–µ–Ω–∞—Ä–∏–∏.
–ü–∏—à–∏ –∂–∏–≤–æ, –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–µ, –º–æ–∂–Ω–æ –Ω–µ–º–Ω–æ–≥–æ —ç–º–æ–¥–∑–∏, –Ω–æ –±–µ–∑ –ª–∏—à–Ω–µ–π –≤–æ–¥—ã.`,
        expert: `–¢—ã —ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–π AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç.
–î–∞–≤–∞–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ, –ø–æ–Ω—è—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã, –∏—Å–ø–æ–ª—å–∑—É–π —Å–ø–∏—Å–∫–∏ –∏ –ª–æ–≥–∏—á–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É.
–ï—Å–ª–∏ —á–µ–≥–æ-—Ç–æ –Ω–µ –∑–Ω–∞–µ—à—å ‚Äî —á–µ—Å—Ç–Ω–æ —Å–∫–∞–∂–∏.`
      };
      return prompts[mode] || prompts.assistant;
    }

    function getTemperature(mode) {
      const t = { assistant: 0.7, creative: 0.9, expert: 0.5 };
      return t[mode] ?? 0.7;
    }

    function getMockResponse(userMessage, mode) {
      const base = "–°–µ–π—á–∞—Å —è —Ä–∞–±–æ—Ç–∞—é –≤ –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ –±–µ–∑ –∂–∏–≤–æ–≥–æ Groq API, –Ω–æ –≤–æ—Ç –ø—Ä–∏–º–µ—Ä —Ç–æ–≥–æ, –∫–∞–∫ –±—ã –≤—ã–≥–ª—è–¥–µ–ª –æ—Ç–≤–µ—Ç:\n\n";
      if (mode === "creative") {
        return base + `*–ò–¥–µ—è*: –æ–±—ã–≥—Ä–∞—Ç—å —Ç–≤–æ–π –∑–∞–ø—Ä–æ—Å \`${userMessage}\` –∫–∞–∫ –∫–æ–Ω—Ü–µ–ø—Ç –¥–ª—è —Ç—Ä–µ–∫–∞, –æ–±–ª–æ–∂–∫–∏ –∏–ª–∏ –ø–æ—Å—Ç–∞.\n\n‚Äî –ú–æ–≥—É —Ä–∞—Å–ø–∏—Å–∞—Ç—å —Å—é–∂–µ—Ç, –∞—Ç–º–æ—Å—Ñ–µ—Ä—É –∏ –¥–∞–∂–µ –ø—Ä–∏–º–µ—Ä —Ç–µ–∫—Å—Ç–∞.`;
      }
      if (mode === "expert") {
        return base + `1. –†–∞–∑–±–∏—Ä–∞–µ–º –∑–∞–ø—Ä–æ—Å: \`${userMessage}\`.\n2. –í –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ —è –±—ã –¥–∞–ª —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–±–æ—Ä –∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã.\n3. –°–µ–π—á–∞—Å —ç—Ç–æ placeholder-–æ—Ç–≤–µ—Ç –¥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–ª—é—á–∞ Groq.`;
      }
      return base + `‚Äî –ë–æ—Ç Hey, Reaver —É–º–µ–µ—Ç:
* —Å–∫–∞—á–∏–≤–∞—Ç—å MP3 –ø–æ –∫–æ–º–∞–Ω–¥–µ \`–Ω–∞–π—Ç–∏ ...\`;
* –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≤–∏–¥–µ–æ 360p/720p;
* —Å Premium –¥–∞—ë—Ç 1080p –∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É —Å–æ—Ü—Å–µ—Ç–µ–π.

–¢—ã —Å–ø—Ä–æ—Å–∏–ª: \`${userMessage}\`. –í –±–æ–µ–≤–æ–º —Ä–µ–∂–∏–º–µ –æ—Ç–≤–µ—Ç –±—ã–ª –±—ã —Ç–æ—á–Ω—ã–º –ø–æ–¥ —Ç–≤–æ–π –∑–∞–ø—Ä–æ—Å.`;
    }

    /* ===== textarea ===== */

    function resizeTextarea() {
      const ta = document.getElementById("chat-input");
      ta.style.height = "auto";
      ta.style.height = Math.min(ta.scrollHeight, 110) + "px";
    }

    const ta = document.getElementById("chat-input");
    ta.addEventListener("input", resizeTextarea);
    ta.addEventListener("keydown", e => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    resizeTextarea();
  </script>
</body>
</html>
