<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Hey, Reaver ‚Ä¢ AI –ß–∞—Ç + Mini App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --bg1: #090018;
      --bg2: #041226;
      --accent1: #00d4ff;
      --accent2: #4e6bff;
      --accent3: #ff6584;
      --text: #f5f5ff;
      --muted: #a9b0d9;
      --glass: rgba(7, 13, 32, 0.76);
      --border: rgba(255, 255, 255, 0.12);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text);
      background:
        radial-gradient(circle at 0 0, #3b0066 0, transparent 55%),
        radial-gradient(circle at 100% 100%, #004b8b 0, transparent 55%),
        radial-gradient(circle at 0 100%, #20004b 0, transparent 55%),
        radial-gradient(circle at 100% 0, #00748b 0, transparent 55%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      overflow: hidden;
    }

    .wrapper {
      width: 100%;
      max-width: 520px;
      position: relative;
    }

    .blob {
      position: absolute;
      border-radius: 999px;
      filter: blur(32px);
      opacity: 0.7;
      pointer-events: none;
      mix-blend-mode: screen;
    }

    .blob.one {
      width: 220px;
      height: 220px;
      background: radial-gradient(circle, var(--accent1), transparent 70%);
      top: -40px;
      right: -40px;
      animation: blobFloat1 12s ease-in-out infinite;
    }

    .blob.two {
      width: 260px;
      height: 260px;
      background: radial-gradient(circle, var(--accent3), transparent 70%);
      bottom: -80px;
      left: -60px;
      animation: blobFloat2 16s ease-in-out infinite;
    }

    @keyframes blobFloat1 {
      0%, 100% { transform: translate(0, 0); }
      50% { transform: translate(-20px, 30px); }
    }

    @keyframes blobFloat2 {
      0%, 100% { transform: translate(0, 0); }
      50% { transform: translate(25px, -25px); }
    }

    .card {
      position: relative;
      z-index: 2;
      background: var(--glass);
      border-radius: 24px;
      padding: 18px 18px 20px;
      border: 1px solid var(--border);
      box-shadow:
        0 18px 45px rgba(0, 0, 0, 0.7),
        0 0 0 1px rgba(255, 255, 255, 0.02);
      backdrop-filter: blur(18px);
      animation: cardEntrance 0.8s ease-out both;
    }

    @keyframes cardEntrance {
      0% {
        transform: translateY(24px);
        opacity: 0;
      }
      100% {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .header-row {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 8px;
    }

    .logo-chip {
      width: 52px;
      height: 52px;
      border-radius: 18px;
      background: linear-gradient(135deg, #00c6ff, #008cff);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      box-shadow: 0 10px 28px rgba(0, 0, 0, 0.6);
    }

    .logo-chip img {
      width: 130%;
      height: auto;
      transform: translateX(6px);
    }

    .title-block {
      flex: 1;
    }

    .title {
      font-size: 18px;
      font-weight: 700;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      background: linear-gradient(90deg, #ffffff, #e4f4ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      font-size: 12px;
      color: var(--muted);
      margin-top: 3px;
    }

    .soon-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.14);
      margin-top: 8px;
    }

    .soon-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--accent1);
      box-shadow: 0 0 12px rgba(0, 212, 255, 0.8);
      animation: pulse 1.4s ease-out infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      70% { transform: scale(1.6); opacity: 0; }
      100% { transform: scale(1); opacity: 0; }
    }

    .mode-switcher {
      display: flex;
      gap: 8px;
      margin: 14px 0 10px;
    }

    .mode-btn {
      flex: 1;
      padding: 9px 12px;
      border: none;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.04);
      color: var(--muted);
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.22s ease;
    }

    .mode-btn.active {
      background: linear-gradient(135deg, rgba(0, 212, 255, 0.2), rgba(78, 107, 255, 0.25));
      color: var(--text);
      box-shadow: 0 0 14px rgba(0, 212, 255, 0.35);
    }

    .mode-btn:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: none;
    }

    /* ===== –±–ª–æ–∫ ¬´–§—É–Ω–∫—Ü–∏–∏¬ª ===== */
    .features {
      border-radius: 18px;
      padding: 10px 12px;
      background: rgba(2, 5, 22, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.06);
      overflow: hidden;
      position: relative;
    }

    .features-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--muted);
      margin-bottom: 6px;
    }

    .features-viewport {
      position: relative;
      height: 52px;
    }

    .feature-item {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      opacity: 0;
      transform: translateY(12px);
      animation: featureCycle 15s infinite;
    }

    .feature-item span.icon {
      font-size: 16px;
      width: 22px;
      text-align: center;
    }

    .feature-item:nth-child(1) { animation-delay: 0s; }
    .feature-item:nth-child(2) { animation-delay: 3s; }
    .feature-item:nth-child(3) { animation-delay: 6s; }
    .feature-item:nth-child(4) { animation-delay: 9s; }
    .feature-item:nth-child(5) { animation-delay: 12s; }

    @keyframes featureCycle {
      0% {
        opacity: 0;
        transform: translateY(12px);
      }
      8% {
        opacity: 1;
        transform: translateY(0);
      }
      22% {
        opacity: 1;
        transform: translateY(0);
      }
      30% {
        opacity: 0;
        transform: translateY(-8px);
      }
      100% {
        opacity: 0;
        transform: translateY(-8px);
      }
    }

    /* ===== —á–∞—Ç ===== */
    .chat-container {
      margin-top: 10px;
      border-radius: 18px;
      padding: 12px 12px 14px;
      background: rgba(2, 5, 22, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.06);
      display: none;
      flex-direction: column;
      max-height: 65vh;
      min-height: 50vh;
    }

    @media (max-height: 650px) {
      .chat-container {
        max-height: 56vh;
        min-height: 46vh;
      }
    }

    .chat-controls {
      display: flex;
      gap: 6px;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }

    .chat-mode-btn {
      padding: 7px 10px;
      border: none;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.04);
      color: var(--muted);
      font-size: 11px;
      cursor: pointer;
      transition: all 0.2s ease;
      flex: 1;
      min-width: 0;
    }

    .chat-mode-btn.active {
      background: linear-gradient(135deg, rgba(255, 101, 132, 0.2), rgba(255, 101, 132, 0.1));
      color: var(--text);
    }

    .clear-chat-btn {
      padding: 7px 10px;
      border: none;
      border-radius: 10px;
      background: rgba(255, 101, 132, 0.12);
      color: var(--accent3);
      font-size: 11px;
      cursor: pointer;
      white-space: nowrap;
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      margin-bottom: 10px;
      padding-right: 4px;
    }

    .chat-messages::-webkit-scrollbar {
      width: 4px;
    }
    .chat-messages::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.04);
      border-radius: 2px;
    }
    .chat-messages::-webkit-scrollbar-thumb {
      background: var(--accent1);
      border-radius: 2px;
    }

    .message {
      margin-bottom: 10px;
      padding: 9px 10px;
      border-radius: 12px;
      font-size: 13px;
      line-height: 1.4;
      animation: messageSlide 0.22s ease-out both;
    }

    @keyframes messageSlide {
      0% { transform: translateY(6px); opacity: 0; }
      100% { transform: translateY(0); opacity: 1; }
    }

    .message.user {
      background: linear-gradient(135deg, rgba(0, 212, 255, 0.18), rgba(78, 107, 255, 0.16));
      border: 1px solid rgba(0, 212, 255, 0.3);
      margin-left: 28px;
    }

    .message.assistant {
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.14);
      margin-right: 28px;
    }

    .message-text {
      word-wrap: break-word;
    }

    .message-text code {
      font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      background: rgba(0, 0, 0, 0.4);
      padding: 1px 4px;
      border-radius: 4px;
    }

    .message-text pre {
      margin: 6px 0 4px;
      padding: 8px;
      background: rgba(0, 0, 0, 0.5);
      border-radius: 8px;
      overflow-x: auto;
      font-size: 12px;
    }

    .message-text ul,
    .message-text ol {
      padding-left: 18px;
      margin: 4px 0;
    }

    .message-meta {
      font-size: 10px;
      color: var(--muted);
      margin-top: 4px;
      text-align: right;
    }

    .typing-indicator {
      display: flex;
      gap: 4px;
      padding: 8px 4px;
      align-items: center;
      font-size: 12px;
      color: var(--muted);
    }

    .typing-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--accent1);
      animation: typingBounce 1.4s ease-in-out infinite both;
    }

    .typing-dot:nth-child(1) { animation-delay: -0.32s; }
    .typing-dot:nth-child(2) { animation-delay: -0.16s; }
    .typing-dot:nth-child(3) { animation-delay: 0s; }

    @keyframes typingBounce {
      0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
      40% { transform: scale(1); opacity: 1; }
    }

    .chat-input-container {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .chat-input {
      flex: 1;
      padding: 10px 12px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 12px;
      background: rgba(0, 0, 0, 0.35);
      color: var(--text);
      font-size: 13px;
      outline: none;
      resize: none;
      min-height: 40px;
      max-height: 110px;
    }

    .chat-input:focus {
      border-color: var(--accent1);
      box-shadow: 0 0 0 2px rgba(0, 212, 255, 0.2);
    }

    .send-btn {
      padding: 10px 12px;
      border: none;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--accent1), var(--accent2));
      color: white;
      cursor: pointer;
      font-weight: 600;
      min-width: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .send-btn:active {
      transform: scale(0.97);
      box-shadow: none;
    }

    .send-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .bottom-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 12px;
      font-size: 11px;
      color: var(--muted);
    }

    .tag {
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    .bot-handle {
      opacity: 0.9;
    }

    @media (max-width: 360px) {
      .card { padding: 14px; }
      .title { font-size: 16px; }
      .chat-container { min-height: 48vh; }
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="blob one"></div>
    <div class="blob two"></div>

    <div class="card">
      <div class="header-row">
        <div class="logo-chip">
          <!-- –ü–æ–¥—Å—Ç–∞–≤—å —Å—é–¥–∞ –ª–æ–≥–æ—Ç–∏–ø –≤ —Å—Ç–∏–ª–µ –æ–±–ª–æ–∂–∫–∏ -->
          <img src="heyreaver_logo.png" alt="Hey, Reaver logo">
        </div>
        <div class="title-block">
          <div class="title">Hey, Reaver ‚Ä¢ AI —á–∞—Ç</div>
          <div class="subtitle">–ù–æ–≤–∞—è –∞–π–¥–µ–Ω—Ç–∏–∫–∞ –≤ –¥–µ–ª–µ. –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –≤–Ω—É—Ç—Ä–∏ –±–æ—Ç–∞.</div>
          <div class="soon-pill">
            <div class="soon-dot"></div>
            <span>Groq AI ‚Ä¢ ultra fast –æ—Ç–≤–µ—Ç</span>
          </div>
        </div>
      </div>

      <div class="mode-switcher">
        <button class="mode-btn active" id="mode-features" onclick="switchMode('features')">–§—É–Ω–∫—Ü–∏–∏ –±–æ—Ç–∞</button>
        <button class="mode-btn" id="mode-chat" onclick="switchMode('chat')">AI-—á–∞—Ç</button>
      </div>

      <!-- –ë–ª–æ–∫ —Ñ—É–Ω–∫—Ü–∏–π -->
      <div class="features" id="features-section">
        <div class="features-label">—á—Ç–æ —É–∂–µ —É–º–µ–µ—Ç hey, reaver</div>
        <div class="features-viewport">
          <div class="feature-item">
            <span class="icon">üéµ</span>
            <span>–°–∫–∞—á–∏–≤–∞–µ—Ç —Ç—Ä–µ–∫–∏ –≤ MP3 –ø–æ –∑–∞–ø—Ä–æ—Å—É <code>–Ω–∞–π—Ç–∏&nbsp;—Ç—Ä–µ–∫</code></span>
          </div>
          <div class="feature-item">
            <span class="icon">üìπ</span>
            <span>–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤–∏–¥–µ–æ 360p / 720p —Å YouTube</span>
          </div>
          <div class="feature-item">
            <span class="icon">‚≠ê</span>
            <span>Premium: 1080p, –±–µ–∑–ª–∏–º–∏—Ç –∏ —Å–æ—Ü—Å–µ—Ç–∏ (Instagram, X)</span>
          </div>
          <div class="feature-item">
            <span class="icon">‚è≥</span>
            <span>–¢—Ä–∏–∞–ª –∏ –ø–æ–¥–ø–∏—Å–∫–∞ –∑–∞ Telegram Stars ‚Äî –±–µ–∑ –∫–∞—Ä—Ç</span>
          </div>
          <div class="feature-item">
            <span class="icon">üéÅ</span>
            <span>–ü—Ä–æ–º–æ–∫–æ–¥—ã, –∞–∫—Ü–∏–∏ –∏ –ø–æ–¥–∞—Ä–æ—á–Ω—ã–π Premium</span>
          </div>
        </div>
      </div>

      <!-- –ë–ª–æ–∫ —á–∞—Ç–∞ -->
      <div class="chat-container" id="chat-section">
        <div class="chat-controls">
          <button class="chat-mode-btn active" onclick="switchChatMode('assistant', this)">–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç</button>
          <button class="chat-mode-btn" onclick="switchChatMode('creative', this)">–ö—Ä–µ–∞—Ç–∏–≤–Ω—ã–π</button>
          <button class="chat-mode-btn" onclick="switchChatMode('expert', this)">–≠–∫—Å–ø–µ—Ä—Ç</button>
          <button class="clear-chat-btn" onclick="clearChat()">–û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>

        <div class="chat-messages" id="chat-messages">
          <div class="message assistant">
            <div class="message-text">
              <p><strong>–ü—Ä–∏–≤–µ—Ç!</strong> –Ø AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç Hey, Reaver.</p>
              <p>–í—ã–±–µ—Ä–∏ —Ä–µ–∂–∏–º –æ–±—â–µ–Ω–∏—è –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –∑–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å ‚Äî –ø–æ–º–æ–≥—É —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –±–æ—Ç–∞, –∏–¥–µ—è–º–∏ –∏ —á–µ–º —É–≥–æ–¥–Ω–æ. üöÄ</p>
            </div>
            <div class="message-meta">–°–∏—Å—Ç–µ–º–∞ ‚Ä¢ —Ç–æ–ª—å–∫–æ —á—Ç–æ</div>
          </div>
        </div>

        <div class="chat-input-container">
          <textarea
            class="chat-input"
            id="chat-input"
            placeholder="–ù–∞–ø–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶ (Enter ‚Äî –æ—Ç–ø—Ä–∞–≤–∏—Ç—å, Shift+Enter ‚Äî –Ω–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞)"
            maxlength="1000"
            rows="1"
          ></textarea>
          <button class="send-btn" id="send-btn" onclick="sendMessage()">
            ‚û§
          </button>
        </div>
      </div>

      <div class="bottom-row">
        <div class="tag">Groq AI ‚Ä¢ Markdown-–æ—Ç–≤–µ—Ç—ã</div>
        <div class="bot-handle">@reaver_youtube_bot</div>
      </div>
    </div>
  </div>

  <script>
    const tg = window.Telegram?.WebApp;

    if (tg) {
      tg.ready();
      tg.expand();
      document.body.style.backgroundColor = tg.backgroundColor || "#090018";

      const user = tg.initDataUnsafe?.user;
      if (user) {
        const subtitle = document.querySelector(".subtitle");
        const name = user.username ? "@" + user.username : (user.first_name || "–¥—Ä—É–≥");
        subtitle.textContent = `–ü—Ä–∏–≤–µ—Ç, ${name}. –£–ø—Ä–∞–≤–ª—è–π –±–æ—Ç–æ–º –∏ –æ–±—â–∞–π—Å—è —Å AI –ø—Ä—è–º–æ –∑–¥–µ—Å—å.`;
      }
    }

    /* ===== Markdown —Ä–µ–Ω–¥–µ—Ä–µ—Ä (–ª–∞–π—Ç) ===== */

    function escapeHtml(str) {
      return str
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;");
    }

    function renderMarkdown(md) {
      if (!md) return "";

      let text = escapeHtml(md);

      // –∑–∞–≥–æ–ª–æ–≤–∫–∏
      text = text.replace(/^### (.+)$/gm, "<h3>$1</h3>");
      text = text.replace(/^## (.+)$/gm, "<h2>$1</h2>");
      text = text.replace(/^# (.+)$/gm, "<h1>$1</h1>");

      // —Å–ø–∏—Å–∫–∏
      text = text.replace(/(^|\n)[ \t]*[-*] (.+)/g, (m, p1, item) => `${p1}<ul><li>${item}</li></ul>`);
      text = text.replace(/<\/ul>\s*<ul>/g, "</ul>");

      // –∂–∏—Ä–Ω—ã–π / –∫—É—Ä—Å–∏–≤
      text = text.replace(/\*\*(.+?)\*\*/g, "<strong>$1</strong>");
      text = text.replace(/\*(.+?)\*/g, "<em>$1</em>");

      // –∏–Ω–ª–∞–π–Ω-–∫–æ–¥
      text = text.replace(/`([^`]+)`/g, "<code>$1</code>");

      // —Å—Å—ã–ª–∫–∏
      text = text.replace(/\[([^\]]+)\]\((https?:\/\/[^\s)]+)\)/g, '<a href="$2" target="_blank" rel="noreferrer">$1</a>');

      // –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–π –∫–æ–¥ ``` ```
      text = text.replace(/```([\s\S]*?)```/g, "<pre><code>$1</code></pre>");

      // –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ -> <br>, –∫—Ä–æ–º–µ —É–∂–µ –≤—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤
      text = text.replace(/\n{2,}/g, "</p><p>");
      text = "<p>" + text.replace(/\n/g, "<br>") + "</p>";

      return text;
    }

    /* ===== UI –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ ===== */

    function switchMode(mode) {
      const featuresBtn = document.getElementById("mode-features");
      const chatBtn = document.getElementById("mode-chat");
      const featuresSection = document.getElementById("features-section");
      const chatSection = document.getElementById("chat-section");

      if (mode === "features") {
        featuresBtn.classList.add("active");
        chatBtn.classList.remove("active");
        featuresSection.style.display = "block";
        chatSection.style.display = "none";
      } else {
        featuresBtn.classList.remove("active");
        chatBtn.classList.add("active");
        featuresSection.style.display = "none";
        chatSection.style.display = "flex";

        // –∞–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
        setTimeout(() => document.getElementById("chat-input").focus(), 200);
      }
    }

    let chatMode = "assistant";
    let chatHistory = [];
    let isWaitingForResponse = false;

    function switchChatMode(mode, btn) {
      chatMode = mode;
      document.querySelectorAll(".chat-mode-btn").forEach(b => b.classList.remove("active"));
      if (btn) btn.classList.add("active");
      addSystemMessage(`–†–µ–∂–∏–º: ${getModeDescription(mode)}`);
    }

    function getModeDescription(mode) {
      const modes = {
        "assistant": "–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç ‚Äî –ø–æ–º–æ–≥–∞–µ—Ç —Å –±–æ—Ç–æ–º –∏ –æ–±—â–∏–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏",
        "creative": "–ö—Ä–µ–∞—Ç–∏–≤–Ω—ã–π ‚Äî –∏–¥–µ–∏, —Ç–µ–∫—Å—Ç—ã, —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ",
        "expert": "–≠–∫—Å–ø–µ—Ä—Ç ‚Äî –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω—ã–µ –∏ –≥–ª—É–±–æ–∫–∏–µ –æ—Ç–≤–µ—Ç—ã"
      };
      return modes[mode] || "–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç";
    }

    function clearChat() {
      const container = document.getElementById("chat-messages");
      container.innerHTML = "";
      chatHistory = [];
      addSystemMessage("–ß–∞—Ç –æ—á–∏—â–µ–Ω. –û —á—ë–º –ø–æ–≥–æ–≤–æ—Ä–∏–º? üéß");
    }

    function addSystemMessage(text) {
      addMessage(text, "assistant", true);
    }

    function addMessage(text, sender, isSystem = false) {
      const container = document.getElementById("chat-messages");
      const div = document.createElement("div");
      div.className = `message ${sender}`;

      const ts = new Date().toLocaleTimeString("ru-RU", {
        hour: "2-digit",
        minute: "2-digit"
      });

      div.innerHTML = `
        <div class="message-text">${renderMarkdown(text)}</div>
        <div class="message-meta">${isSystem ? "–°–∏—Å—Ç–µ–º–∞" : (sender === "user" ? "–í—ã" : "AI")} ‚Ä¢ ${ts}</div>
      `;

      container.appendChild(div);
      container.scrollTop = container.scrollHeight;
    }

    function showTyping() {
      const container = document.getElementById("chat-messages");
      const div = document.createElement("div");
      div.className = "typing-indicator";
      div.id = "typing-indicator";
      div.innerHTML = `
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
        <span style="margin-left: 6px;">AI –ø–µ—á–∞—Ç–∞–µ—Ç‚Ä¶</span>
      `;
      container.appendChild(div);
      container.scrollTop = container.scrollHeight;
    }

    function hideTyping() {
      const el = document.getElementById("typing-indicator");
      if (el) el.remove();
    }

    async function sendMessage() {
      if (isWaitingForResponse) return;

      const input = document.getElementById("chat-input");
      const text = input.value.trim();
      if (!text) return;

      addMessage(text, "user");
      input.value = "";
      resizeTextarea();

      showTyping();
      isWaitingForResponse = true;
      document.getElementById("send-btn").disabled = true;

      try {
        const answer = await callGroqAPI(text, chatMode);
        hideTyping();
        addMessage(answer, "assistant");

        chatHistory.push({ role: "user", content: text });
        chatHistory.push({ role: "assistant", content: answer });
        if (chatHistory.length > 20) chatHistory = chatHistory.slice(-20);
      } catch (e) {
        console.error(e);
        hideTyping();
        addMessage("–ò–∑–≤–∏–Ω–∏, —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫. –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑ —á—É—Ç—å –ø–æ–∑–∂–µ.", "assistant");
      }

      isWaitingForResponse = false;
      document.getElementById("send-btn").disabled = false;
    }

    /* ===== Groq API ===== */

    const GROQ_API_KEY = "YOUR_GROQ_API_KEY_HERE"; // ‚ö† —Å—é–¥–∞ –ª—É—á—à–µ –Ω–µ —Å—Ç–∞–≤–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π –∫–ª—é—á, –¥–µ–ª–∞–π –ø—Ä–æ–∫—Å–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
    const GROQ_API_URL = "https://api.groq.com/openai/v1/chat/completions";

    async function callGroqAPI(userMessage, mode) {
      // –µ—Å–ª–∏ –∫–ª—é—á –Ω–µ –∑–∞–¥–∞–Ω ‚Äî –º–æ–∫-—Ä–µ–∂–∏–º (–±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ API)
      if (!GROQ_API_KEY || GROQ_API_KEY === "YOUR_GROQ_API_KEY_HERE") {
        await new Promise(r => setTimeout(r, 600 + Math.random() * 600));
        return getMockResponse(userMessage, mode);
      }

      const systemPrompt = getSystemPrompt(mode);
      const messages = [
        { role: "system", content: systemPrompt },
        ...chatHistory,
        { role: "user", content: userMessage }
      ];

      const res = await fetch(GROQ_API_URL, {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${GROQ_API_KEY}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          model: "llama3-8b-8192",
          messages,
          temperature: getTemperature(mode),
          max_tokens: 1024,
          stream: false
        })
      });

      if (!res.ok) throw new Error("Groq API error: " + res.status);
      const data = await res.json();
      return data.choices?.[0]?.message?.content || "–ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç –æ—Ç –º–æ–¥–µ–ª–∏ üòî";
    }

    function getSystemPrompt(mode) {
      const prompts = {
        "assistant": `–¢—ã –ø–æ–ª–µ–∑–Ω—ã–π AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –±–æ—Ç–∞ Hey, Reaver.
–¢—ã –ø–æ–º–æ–≥–∞–µ—à—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:
‚Äî —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –±–æ—Ç–∞ (–ø–æ–∏—Å–∫ —Ç—Ä–µ–∫–æ–≤, —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ, Premium, –ª–∏–º–∏—Ç—ã);
‚Äî –æ—Ç–≤–µ—á–∞–µ—à—å –Ω–∞ –ª—é–±—ã–µ –≤–æ–ø—Ä–æ—Å—ã –≤ –¥—Ä—É–∂–µ–ª—é–±–Ω–æ–π —Ñ–æ—Ä–º–µ.
–ü–∏—à–∏ –∫–æ–º–ø–∞–∫—Ç–Ω–æ, –Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ. –ò—Å–ø–æ–ª—å–∑—É–π Markdown: —Å–ø–∏—Å–∫–∏, –≤—ã–¥–µ–ª–µ–Ω–∏–µ, –∫–æ–¥, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ.`,
        "creative": `–¢—ã –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–π AI-–ø–æ–º–æ—â–Ω–∏–∫.
–ü–æ–º–æ–≥–∞–µ—à—å –ø—Ä–∏–¥—É–º—ã–≤–∞—Ç—å –∏–¥–µ–∏, —Ç–µ–∫—Å—Ç—ã, –æ–ø–∏—Å–∞–Ω–∏—è, —Å—Ü–µ–Ω–∞—Ä–∏–∏, –ø–æ—Å—Ç—ã.
–ü–∏—à–∏ –∂–∏–≤–æ, –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–µ, –Ω–æ –±–µ–∑ –ª–∏—à–Ω–µ–π –≤–æ–¥—ã. –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–µ–º–Ω–æ–≥–æ —ç–º–æ–¥–∑–∏.`,
        "expert": `–¢—ã —ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Å —Ö–æ—Ä–æ—à–∏–º–∏ –∑–Ω–∞–Ω–∏—è–º–∏.
–û—Ç–≤–µ—á–∞–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–æ, –ø–æ –ø—É–Ω–∫—Ç–∞–º, –∏—Å–ø–æ–ª—å–∑—É–π —Å–ø–∏—Å–∫–∏ –∏ –ø–æ—è—Å–Ω–µ–Ω–∏—è.
–ï—Å–ª–∏ –µ—Å—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∑–Ω–∞–Ω–∏–π ‚Äî –º—è–≥–∫–æ —É–ø–æ–º–∏–Ω–∞–π –æ–± —ç—Ç–æ–º.`
      };
      return prompts[mode] || prompts["assistant"];
    }

    function getTemperature(mode) {
      const t = { assistant: 0.7, creative: 0.9, expert: 0.5 };
      return t[mode] ?? 0.7;
    }

    function getMockResponse(userMessage, mode) {
      const base = "–°–µ–π—á–∞—Å —è —Ä–∞–±–æ—Ç–∞—é –≤ –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ –±–µ–∑ –∂–∏–≤–æ–≥–æ Groq API, –Ω–æ –≤–æ—Ç –ø—Ä–∏–º–µ—Ä —Ç–æ–≥–æ, –∫–∞–∫ —è –±—ã –æ—Ç–≤–µ—Ç–∏–ª:\n\n";
      if (mode === "creative") {
        return base + `*–ò–¥–µ—è:* –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å —Ç–≤–æ–π –∑–∞–ø—Ä–æ—Å –≤ –º–∏–Ω–∏-–∏—Å—Ç–æ—Ä–∏—é –∏–ª–∏ –∫–æ–Ω—Ü–µ–ø—Ç.\n\n‚Äî –¢—ã –Ω–∞–ø–∏—Å–∞–ª: \`${userMessage}\`\n‚Äî –Ø –º–æ–≥—É –ø–æ–º–æ—á—å –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å —ç—Ç–æ –≤ —Ç–µ–∫—Å—Ç, —Å—Ü–µ–Ω–∞—Ä–∏–π, –æ–ø–∏—Å–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞ –∏–ª–∏ –≤–∏–∑—É–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ü–µ–ø—Ç.`;
      }
      if (mode === "expert") {
        return base + `1. –†–∞–∑–±–∏—Ä–∞–µ–º –∑–∞–ø—Ä–æ—Å: \`${userMessage}\`.\n2. –í —Ä–µ–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ —è –±—ã –¥–∞–ª —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–±–æ—Ä.\n3. –°–µ–π—á–∞—Å –º–æ–∂–Ω–æ —Å—á–∏—Ç–∞—Ç—å —ç—Ç–æ placeholder-–æ—Ç–≤–µ—Ç–æ–º, –ø–æ–∫–∞ –Ω–µ –ø–æ–¥–∫–ª—é—á—ë–Ω –∫–ª—é—á Groq.`;
      }
      return base + `‚Äî –ë–æ—Ç Hey, Reaver —É–º–µ–µ—Ç:\n  * —Å–∫–∞—á–∏–≤–∞—Ç—å MP3 –ø–æ –∫–æ–º–∞–Ω–¥–µ \`–Ω–∞–π—Ç–∏ ...\`;\n  * –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≤–∏–¥–µ–æ 360p/720p;\n  * –≤ Premium –¥–∞—ë—Ç 1080p + —Å–æ—Ü—Å–µ—Ç–∏.\n\n–¢—ã —Å–ø—Ä–æ—Å–∏–ª: \`${userMessage}\`. –í –±–æ–µ–≤–æ–º —Ä–µ–∂–∏–º–µ —è –±—ã –æ—Ç–≤–µ—Ç–∏–ª —Ç–æ—á–Ω–µ–µ.`;
    }

    /* ===== textarea –ø–æ–≤–µ–¥–µ–Ω–∏–µ ===== */

    function resizeTextarea() {
      const ta = document.getElementById("chat-input");
      ta.style.height = "auto";
      ta.style.height = Math.min(ta.scrollHeight, 110) + "px";
    }

    const ta = document.getElementById("chat-input");
    ta.addEventListener("input", resizeTextarea);
    ta.addEventListener("keydown", e => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    resizeTextarea();
  </script>
</body>
</html>
